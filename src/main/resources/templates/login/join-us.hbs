{{#> layout/default title="회원가입" }}
  {{#*inline "contents"}}
    <main class="login-form">
      <div class="cotainer">
        <div class="row justify-content-center">
          <div class="col-md-8">
            <div class="card">
              <div class="card-header">회원 가입</div>
              <div class="card-body">
                <form id="join-form" action="/login/join-us" method="post">
                  {{#if msg}}
                    <div class="form-group row">
                      <label for="email_address" class="col-md-4 col-form-label text-md-right"></label>
                      <div class="col-md-6" style="background-color:#FF4500;border-radius:0.5em;font-size:1.5em;color:white;text-align:center">
                        {{msg}}
                      </div>
                    </div>
                  {{/if}}
                  <div class="form-group row">
                    <label for="email_address" class="col-md-4 col-form-label text-md-right">아이디</label>
                    <div class="col-md-6">
                      <input type="text" id="email_address" class="form-control" name="username" autofocus>
                    </div>
                    <button type="button" id="username-check">중복 확인</button>
                  </div>

                  <div class="form-group row">
                    <label for="password" class="col-md-4 col-form-label text-md-right">비밀번호</label>
                    <div class="col-md-6">
                      <input type="password" id="password1" class="form-control" name="password">
                    </div>
                  </div>

                  <div class="form-group row">
                    <label for="password" class="col-md-4 col-form-label text-md-right">비밀번호 확인</label>
                    <div class="col-md-6">
                      <input type="password" id="password2" class="form-control" name="password2">
                    </div>
                  </div>

                  <div class="form-group row">
                    <label for="email_address" class="col-md-4 col-form-label text-md-right">이름</label>
                    <div class="col-md-6">
                      <input type="text" class="form-control" name="name">
                    </div>
                  </div>

                  <div class="col-md-6 offset-md-4">
                    <button type="submit" class="btn btn-primary">
                      회원가입
                    </button>
                  </div>
               </form>
             </div>
            </div>
         </div>
        </div>
      </div>
    </main>
  {{/inline}}
  {{#*inline "js"}}
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
    <script>
      $(function(){
        var check = false;
        var $username = $('input[name="username"]');
        var check_username = '';

        $('#username-check').on('click', function(event){
          if (check_username !== $username.val()) {
            check = false;
          }

          if (check) {
            alert('중복확인 하셨습니다.');
            return;
          }

          if ($username.val() === '') {
            alert('아이디 기입해 주세요.');
            return;
          }

          if ($username.val().length < 4) {
            alert('아이디는 최소 4글자 이상 입니다.');
            return;
          }

          $.ajax({
            url: '/login/username-check',
            type: 'post',
            data: {username : $username.val()},
            dataType: 'json',
            success: function(data) {
              console.log("data = " + data);
              console.log("data result = " + data.result);
              if (data.result) {
                alert('이미 존재하는 아이디 입니다.');
              } else {
                alert('사용하셔도 되는 아이디 입니다.');
                check_username = $username.val();
                check = true;
              }
            },
            error: function() {
              alert('아이디를 기입해 주세요.');
            }
          });
        });

        $('#join-form').validate({
          submitHandler: function() {
            if (! check) {
              alert('중복 확인해 주세요.');
              return false;
            }

            return true;
          },
          rules: {
            username: {
              required: true,
              minlength: 4,
              maxlength: 20
            },
            password: {
              required: true,
              minlength: 6,
              maxlength: 20
            },
            password2: {
              required: true,
              equalTo: "#password1"
            },
            name: {
              required: true,
              minlength: 2
            }
          },
          messages: {
            username: {
              required: "아이디 입력해 주세요",
              minlength: "아이디는 최소 4글자 이상 입니다.",
              maxlength: "아이디는 최대 20자 이하 입니다."
            },
            password: {
              required: "비밀번호 입력해 주세요.",
              minlength: "비밀번호는 최소 6자 이상 입니다.",
              maxlength: "비밀번호는 최대 20자 입니다."
            },
            password2: {
              required: "비밀번호 재확인 기입해 주세요.",
              equalTo: "비밀번호와 맞지 않습니다."
            },
            name: {
              required: "이름 기입해 주세요.",
              minlength: "이름은 최소 2자 이상 입니다."
            }
          }
        });
      })
    </script>
  {{/inline}}
{{/layout/default}}